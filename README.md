
<p align="center">
  <img src="mascot.png" width="200" alt="桃源自动小助手">
</p>
<h1 align="center">🍃 桃源深处有人家 - 自动运营助手 (V2.2)</h1>

<p align="center">
  基于 <strong>模拟器控制</strong> + <strong>视觉大模型</strong> 的无人值守自动化运营系统
</p>

<p align="center">
  <img src="https://img.shields.io/badge/Python-3.10+-blue"/>
  <img src="https://img.shields.io/badge/Emulator-MuMu-orange"/>
  <img src="https://img.shields.io/badge/AI-Zhipu%20GLM--4V-purple"/>
</p>

关键词：桃源深处有人家辅助、自动收菜、挂机脚本、Python自动化、安卓模拟器脚本。

---
## 📢 V2.2 版本更新重点
v2.2 针对做菜位置随机做出逻辑调整

## 📢 V2.1 版本更新重点
v2.1 增加识别能力：优化Prompt与裁剪参数

## 📢 V2 版本更新重点

本项目已迎来重大重构，核心进化如下：

1.  **彻底摆脱鼠标**：采用 ADB 后台指令控制。**脚本运行时不占用鼠标**，你可以一边挂机一边操作电脑其他窗口。
2.  **拥有图形界面**：新增 Tkinter UI 界面，不再需要去代码里改参数。
3.  **自定义位置**：所有点击坐标、滑动轨迹均可在界面中自由配置，适配不同机型。

---
## 🎬 Demo 演示和教程

📺 **[点此播放视频 Demo](https://www.bilibili.com/video/BV1jkStBwEyh)**
📺 **[点此播放视频 教程](https://www.bilibili.com/video/BV1XrSYBTETe/)**
## ✨ 核心功能

### 1. 🌾 智能种田
* **智能补种**：通过 VLM 识别作物栏库存，自动计算缺口，优先种植库存最少的作物。
* **无缝衔接**：自动识别土地状态（成熟/空地），实现收种循环。

### 2. 🌲 多点采集
* **自动巡逻**：支持配置多个采集点（伐木林、竹林、息壤等），自动切换场景。
* **动态决策**：对每个采集点进行截图分析，区分“收获”、“生产”、“工作中”状态，自动执行对应操作。

### 3. 🏭 流水线加工
* **通用/特殊工坊支持**：自动适配普通工坊（如磨坊）和特殊工坊（如鸡舍）的操作逻辑。
* **智能生产**：自动收获 $\rightarrow$ 轮询原料库存 $\rightarrow$ 生产最缺的产品。

### 4. 🍳 批量烹饪
* **独立复位**：支持单菜品复位逻辑，防止列表滑动错位。
* **批量制作**：检测到库存不足时，自动连点制作。

### 5. 📜 自动订单
* **一键交付**：自动轮询订单栏位，满足条件即刻交付。

### 6. 🌬️ 蒲公英收发
* **全流程闭环**：自动进入蒲公英小队 $\rightarrow$ 一键收获 $\rightarrow$ 快速装填 $\rightarrow$ 确认出发。

---

## 📝 配置说明

### 1. 配置文件详解
*   **`data.json`**：这是程序实际读取的**用户存档**。你在 UI 界面修改并保存的配置都会存储在这里。
*   **`最终参数.json`**：这是作者提供的**全功能参考配置**（基于 1600x900 分辨率）。初次使用建议参考此文件学习参数结构，或者在配置乱了的时候用来恢复。

### 2. 保存机制说明
*   **自动保存**：当你修改某个配置项后，需要**点击界面的其他空白区域**（使当前输入框失去焦点），程序才会触发自动保存。
*   **手动保存**：你也可以修改完所有项后，点击界面底部的“**保存并应用配置**”按钮，这会强制保存并刷新生效。

### 3. 列表格式注意
在配置界面输入列表参数时，请务必使用**英文逗号** `,` 分隔。
*   ✅ 正确：`['清汤白菜', '蛋炒饭']`
*   ❌ 错误：`['清汤白菜'， '蛋炒饭']` （使用了中文逗号）

### 4. 存档与初始化建议
*   **初次使用**：建议直接将项目目录下的 `最终参数.json` 重命名为 `data.json`，这样打开软件就是全功能默认配置的状态。
*   **备份建议**：配置好适合你自己的参数后，建议复制一份 `data.json` 存为备份。如果后续改乱了，只需把备份文件改回名为 `data.json` 放到项目根目录即可恢复。

### 5. ⚠️ 操作警告 (重要)
在“任务列表”界面中，**鼠标滚轮**如果在“任务类型”下拉框上滚动，会直接切换任务类型。
*   **后果**：切换类型会**立即重置并清空**该任务下所有的参数配置！
*   **建议**：在浏览列表时，请小心操作滚轮，避免误触下拉框导致配置丢失。



---

## 📖 自定义指令教学 (ADB Syntax)

在软件的“配置填写”界面中，你可以输入自定义指令来控制脚本行为。支持以下语法：

*   **点击**：`input tap <x> <y>`
    *   例：`input tap 500 500` (点击屏幕中间)
*   **滑动**：`input swipe <x1> <y1> <x2> <y2> <duration_ms>`
    *   例：`input swipe 800 500 200 500 1000` (从右向左滑，耗时1秒)
    ⚠️ 操作警告 swipe的动作要时间长慢慢swipe，不然有不稳定的惯性，导致坐标误差很大。
*   **等待**：`sleep <秒>`
    *   例：`sleep 1.5` (等待1.5秒，用于等待弹窗或动画)
*   **路径拖拽** (本项目特有)：`drag_path <x1> <y1> <x2> <y2> ...`
    *   用于种田和收割，模拟手指按住不放并依序划过所有坐标。
    *   例：`drag_path 100 100 200 200 300 300`

---

---

## ⚠️ 运行前配置建议 (Recommended)


支持 MuMu 模拟器。
为了减少配置修改的工作量，建议模拟器和游戏设置如下：

1.  **分辨率建议**：建议将模拟器分辨率设置为 **1600 x 900 (DPI 240)**。
    *   *说明：默认参数是基于此分辨率录制的。如果你使用其他分辨率，需要在软件配置界面手动修改所有坐标参数。*
    *   *说明：帧率设置要30帧以上，不能后台降帧*
2.  **缩放建议**：虽然脚本包含自动缩小画面的功能，但受限于游戏加载延迟，建议**运行前手动双指捏合将游戏画面缩至最小**，以确保行为正常。
3.  **获取坐标工具**：为了方便你修改配置，建议在模拟器中开启**指针位置显示**：
    *   *设置方法*：进入安卓设置 -> 关于手机 -> 连续点击“版本号”7次 -> 返回进入“系统-开发者选项” -> 找到并开启 **“指针位置”**。
    *   *效果*：开启后，鼠标点击模拟器屏幕上方会显示具体的 (X, Y) 坐标，方便你填入配置。
4.  **游戏设置**：
    *   相机高度：**超远景**。
    *   滑动屏幕：**快**。
## 🚀 快速开始

### 1. ⚠️ 运行前配置 (必读)
参考上一节 **“运行前配置建议”**。

### 2. 获取 API Key
本项目使用 **智谱 AI (GLM-4V)** 进行图像识别。请去智谱开放平台申请 API Key。
👉 [如何获取智谱 API Key](https://zhipu-ef7018ed.mintlify.app/cn/guide/start/quick-start)

### 3. 获取 ADB 路径
找到模拟器自带的 `adb.exe` 文件路径：
*   对着桌面上的 **MuMu模拟器** 图标点击右键 -> 选择 **“打开文件所在的位置”**。
*   在该文件夹下找到 `adb.exe`（在 Windows 中，如果你看不到 .exe 后缀，可以在文件资源管理器中 “查看” → 勾选“文件扩展名” 来显示所有文件后缀）。

### 4. 运行程序
请根据你的情况选择一种方式启动：

#### 🟩 方式一：运行源码 (推荐开发者)
1.  确保电脑已安装 Python 3.10+。
2.  安装项目依赖：
    ```bash
    pip install -r requirements.txt
    ```
3.  启动脚本：
    ```bash
    python main.py
    ```

#### 🟦 方式二：运行 EXE (推荐新手)
*   请前往 **QQ群 (1014644523)** 的群文件下载最新打包好的程序压缩包。
*   双击 `.exe` 即可直接运行，无需安装 Python 环境。

---

## 🛠️ 项目结构
### 📂 源码版结构
```text
TAOYUAN/
├── main.py              # 启动入口
├── build.spec           # PyInstaller 打包配置脚本 (关键源码)
├── requirements.txt     # 依赖包列表 (安装环境用)
├── README.md            # 项目说明文档
├── app.ico              # 程序图标 (.exe使用)
├── mascot.png           # 项目展示 Logo
├── 最终参数.json         # 默认全功能参考配置 (建议新手参考)
├── data.json            # 你的配置文件 (运行后生成/手动改名，不上传)
└── src/                 # 核心源码包
    ├── ui.py            # 图形界面 (Tkinter 动态构建)
    ├── logic.py         # 业务逻辑与数据持久化
    ├── tasks.py         # 六大任务的具体逻辑实现
    ├── adb_utils.py     # ADB 通信、截图、多点触控封装
    └── ai_client.py     # VLM 大模型调用接口
```
### 📦 EXE 发布版结构 (用户到手)
```text
TAOYUAN/
├── TaoyuanHelper.exe    # 双击运行
├── data.json            # 你的配置文件 (运行后生成/手动改名，不上传)
├── 最终参数.json         # 默认全功能参考配置 (建议新手参考)
└── README.md            # 说明书
```
---

## 📮 交流群

QQ群：**1014644523**

---

# 📌 License

本项目仅供学习、研究与技术探索使用。
请勿将脚本用于任何违反游戏规则或破坏游戏平衡的行为。
